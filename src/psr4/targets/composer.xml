<?xml version="1.0" encoding="UTF-8" ?>

  <project name="composer">

    <!-- ============================================  -->
    <!-- Composer target-driven CLI defaults. -->
    <!-- ============================================  -->

    <target name="-composer-lock-preserve" hidden="true">
      <property name="composer-lock-preserve" value="true" />
    </target>

    <!-- ============================================  -->
    <!-- Composer install routine. -->
    <!-- ============================================  -->

    <target name="-composer" hidden="true">

      <if>
        <and>
          <available file="${project.basedir}/composer.json" />
        </and>
        <then>
          <echo msg="Deleting previous: ${project.basedir}/src/vendor" />
          <delete dir="${project.basedir}/src/vendor" includeemptydirs="true" quiet="true" />

          <if>
            <or>
              <not>
                <isset property="composer-lock-preserve" />
              </not>
              <isfalse value="${composer-lock-preserve}" />
            </or>
            <then>
              <echo msg="------------------------------------" />
              <echo msg="Deleting previous: ${project.basedir}/composer.lock" />
              <delete file="${project.basedir}/composer.lock" quiet="true" />
            </then>
          </if>
          <echo msg="------------------------------------" />

          <echo msg="Running Composer." />

          <exec executable="/usr/bin/env" dir="${project.basedir}" passthru="true" checkreturn="true">
            <arg value="composer" />
            <arg value="install" />
          </exec>

          <echo msg="------------------------------------" />
        </then>
        <else>
          <echo msg="N/A: composer.json does not exist in project.basedir." />

          <echo msg="------------------------------------" />
        </else>
      </if>

    </target>

  </project>
