<?xml version="1.0" encoding="UTF-8" ?>

  <project name="rtokens">

    <!-- ============================================  -->
    <!-- Token replacements. -->
    <!-- ============================================  -->

    <target name="-rtokens" hidden="true">

      <!-- Other PHP/JS token replacements. -->

      <echo msg="Replacing tokens in: ${project.basedir}" />

      <reflexive>
        <fileset dir="${project.basedir}" casesensitive="false">
          <exclude pattern="**/vendor/**" />
          <include pattern="*.php" />
          <include pattern="**/*.php" />
          <include pattern="*.js" />
          <include pattern="**/*.js" />
        </fileset>
        <filterchain>
          <replaceregexp>
            <regexp pattern="'[^']*?';\s*\/\/v\/\/$" replace="'${project_version}'; //v//" modifiers="um" />
            <regexp pattern='"[^"]*?";\s*\/\/v\/\/$' replace='"${project_version}"; //v//' modifiers="um" />

            <regexp pattern="'[^']*?';\s*\/\/version\/\/$" replace="'${project_version}'; //version//" modifiers="um" />
            <regexp pattern='"[^"]*?";\s*\/\/version\/\/$' replace='"${project_version}"; //version//' modifiers="um" />

            <regexp pattern="'[^']*?';\s*\/\/php\-required\-version\/\/$" replace="'${project_php_required_version}'; //php-required-version//" modifiers="um" />
            <regexp pattern='"[^"]*?";\s*\/\/php\-required\-version\/\/$' replace='"${project_php_required_version}"; //php-required-version//' modifiers="um" />

            <regexp pattern="'[^']*?';\s*\/\/php\-up\-to\-version\/\/$" replace="'${project_php_tested_up_to_version}'; //php-up-to-version//" modifiers="um" />
            <regexp pattern='"[^"]*?";\s*\/\/php\-up\-to\-version\/\/$' replace='"${project_php_tested_up_to_version}"; //php-up-to-version//' modifiers="um" />
          </replaceregexp>
        </filterchain>
      </reflexive>

      <echo msg="------------------------------------" />

      <!-- WordPress header replacements. -->

      <if>
        <and>
          <istrue value="${_is_wp_theme_plugin}" />
        </and>
        <then>
          <echo msg="Replacing WP headers in: ${project.basedir}" />

          <reflexive>
            <fileset dir="${project.basedir}" casesensitive="false">
              <include pattern="readme.txt" />
              <include pattern="plugin.php" />
              <include pattern="${project_slug}.php" />
              <include pattern="uninstall.php" />
              <include pattern="functions.php" />
              <include pattern="style.css" />
            </fileset>
            <filterchain>
              <replaceregexp>
                <regexp pattern="^(\s*\*\s*)?Version\:.+$" replace="$1Version: ${project_version}" modifiers="um" />
                <regexp pattern="^(\s*\*\s*)?Stable tag\:.+$" replace="$1Stable tag: ${project_version}" modifiers="um" />

                <regexp pattern="^(\s*\*\s*)?Requires at least\:.+$" replace="$1Requires at least: ${project_wp_required_version}" modifiers="um" />
                <regexp pattern="^(\s*\*\s*)?Tested up to\:.+$" replace="$1Tested up to: ${project_wp_tested_up_to_version}" modifiers="um" />

                <regexp pattern="^(\s*\*\s*)?Requires PHP\:.+$" replace="$1Requires PHP: ${project_php_required_version}" modifiers="um" />
                <regexp pattern="^(\s*\*\s*)?Tested up to PHP\:.+$" replace="$1Tested up to PHP: ${project_php_tested_up_to_version}" modifiers="um" />
              </replaceregexp>
            </filterchain>
          </reflexive>

          <if>
            <and>
              <istrue value="${_is_wp_sharks_core_theme_plugin}" />
            </and>
            <then>
              <reflexive>
                <fileset dir="${project.basedir}" casesensitive="false">
                  <include pattern="readme.txt" />
                  <include pattern="plugin.php" />
                  <include pattern="${project_slug}.php" />
                  <include pattern="uninstall.php" />
                  <include pattern="functions.php" />
                  <include pattern="style.css" />
                </fileset>
                <filterchain>
                  <replaceregexp>
                    <regexp pattern="^(\s*\*\s*)?Requires WP Sharks Core\:.+$" replace="$1Requires WP Sharks Core: ${project_wp_sharks_core_required_version}" modifiers="um" />
                    <regexp pattern="^(\s*\*\s*)?Tested up to WP Sharks Core\:.+$" replace="$1Tested up to WP Sharks Core: ${project_wp_sharks_core_tested_up_to_version}" modifiers="um" />
                    <regexp pattern="^(\s*\*\s*)?Max compatible WP Sharks Core\:.+$" replace="$1Max compatible WP Sharks Core: ${project_wp_sharks_core_max_compatible_version}" modifiers="um" />
                  </replaceregexp>
                </filterchain>
              </reflexive>
            </then>
          </if>

          <echo msg="------------------------------------" />
        </then>
        <else>
          <echo msg="N/A: skipping WP header replacements." />

          <echo msg="------------------------------------" />
        </else>
      </if>

      <!-- WordPress token replacements. -->

      <if>
        <and>
          <istrue value="${_is_wp_theme_plugin}" />
        </and>
        <then>
          <echo msg="Replacing WP tokens in: ${project.basedir}" />

          <reflexive>
            <fileset dir="${project.basedir}" casesensitive="false">
              <exclude pattern="**/vendor/**" />
              <include pattern="*.php" />
              <include pattern="**/*.php" />
              <include pattern="*.js" />
              <include pattern="**/*.js" />
            </fileset>
            <filterchain>
              <replaceregexp>
                <regexp pattern="'[^']*?';\s*\/\/wp\-required\-version\/\/$" replace="'${project_wp_required_version}'; //wp-required-version//" modifiers="um" />
                <regexp pattern='"[^"]*?";\s*\/\/wp\-required\-version\/\/$' replace='"${project_wp_required_version}"; //wp-required-version//' modifiers="um" />

                <regexp pattern="'[^']*?';\s*\/\/wp\-up\-to\-version\/\/$" replace="'${project_wp_tested_up_to_version}'; //wp-up-to-version//" modifiers="um" />
                <regexp pattern='"[^"]*?";\s*\/\/wp\-up\-to\-version\/\/$' replace='"${project_wp_tested_up_to_version}"; //wp-up-to-version//' modifiers="um" />
              </replaceregexp>
            </filterchain>
          </reflexive>

          <if>
            <and>
              <istrue value="${_is_wp_sharks_core_theme_plugin}" />
            </and>
            <then>
              <reflexive>
                <fileset dir="${project.basedir}" casesensitive="false">
                  <exclude pattern="**/vendor/**" />
                  <include pattern="*.php" />
                  <include pattern="**/*.php" />
                  <include pattern="*.js" />
                  <include pattern="**/*.js" />
                </fileset>
                <filterchain>
                  <replaceregexp>
                    <regexp pattern="'[^']*?';\s*\/\/wp\-sharks\-core\-required\-version\/\/$" replace="'${project_wp_sharks_core_required_version}'; //wp-sharks-core-required-version//" modifiers="um" />
                    <regexp pattern='"[^"]*?";\s*\/\/wp\-sharks\-core\-required\-version\/\/$' replace='"${project_wp_sharks_core_required_version}"; //wp-sharks-core-required-version//' modifiers="um" />

                    <regexp pattern="'[^']*?';\s*\/\/wp\-sharks\-core\-up\-to\-version\/\/$" replace="'${project_wp_sharks_core_tested_up_to_version}'; //wp-sharks-core-up-to-version//" modifiers="um" />
                    <regexp pattern='"[^"]*?";\s*\/\/wp\-sharks\-core\-up\-to\-version\/\/$' replace='"${project_wp_sharks_core_tested_up_to_version}"; //wp-sharks-core-up-to-version//' modifiers="um" />

                    <regexp pattern="'[^']*?';\s*\/\/wp\-sharks\-core\-max\-compatible\-version\/\/$" replace="'${project_wp_sharks_core_max_compatible_version}'; //wp-sharks-core-max-compatible-version//" modifiers="um" />
                    <regexp pattern='"[^"]*?";\s*\/\/wp\-sharks\-core\-max\-compatible\-version\/\/$' replace='"${project_wp_sharks_core_max_compatible_version}"; //wp-sharks-core-max-compatible-version//' modifiers="um" />
                  </replaceregexp>
                </filterchain>
              </reflexive>
            </then>
          </if>

          <echo msg="------------------------------------" />
        </then>
        <else>
          <echo msg="N/A: skipping WP token replacements." />

          <echo msg="------------------------------------" />
        </else>
      </if>

    </target>

  </project>
