<?xml version="1.0" encoding="UTF-8" ?>

  <project name="casperjs">

    <!-- ============================================  -->
    <!-- Run CasperJS tests via CI server. -->
    <!-- ============================================  -->

    <target name="-casperjs" hidden="true">

      <if>
        <and>
          <isset property="env.CI" />
          <not>
            <isset property="is_lite_build" />
          </not>
          <available resource="${project.basedir}/tests/casperjs" type="dir" />
          <available resource="${project.basedir}/tests/includes/casperjs.js" type="file" />
        </and>
        <then>
          <!-- Run CasperJS tests via CI server. -->

          <echo msg="Running CasperJS tests via CI server." />

          <mkdir dir="${project.basedir}/.~build/.casperjs" />
          <mkdir dir="${project.basedir}/.~build/.casperjs/local-storage" />

          <exec executable="/usr/bin/env" dir="${project.basedir}" passthru="true" checkreturn="true">
            <arg value="casperjs" />
            <arg value="test" />
            <arg value="--concise" />
            <arg value="--fail-fast" />
            <arg value="--ssl-protocol=tlsv1" />
            <arg value="--ignore-ssl-errors=true" />
            <arg value="--cookies-file=${project.basedir}/.~build/.casperjs/cookies.txt" />
            <arg value="--local-storage-path=${project.basedir}/.~build/.casperjs/local-storage" />
            <arg value="--includes=/bootstrap-ci/src/casperjs/includes.js,${project.basedir}/tests/includes/casperjs.js" />
            <arg value="${project.basedir}/tests/casperjs" />
          </exec>

          <echo msg="------------------------------------" />

        </then>

        <else>
          <echo msg="N/A: skipping CasperJS tests via CI server." />

          <echo msg="------------------------------------" />
        </else>
      </if>

    </target>

  </project>
